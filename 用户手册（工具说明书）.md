

## 用户手册（工具说明书）

[TOC]



### 1.引言

#### 1.1 编写目的

本文档从总体架构上给出面向Java的分析与理解工具的轮廓，编写目的在于明确此工具的用户需求，表明需求在本应用的实现形式，使得软件开发人员与用户对需求具有统一的、无二义性的认识，为后期的分析设计、代码实现和测试提供指导，保证团队按时保质地完成开发目标。本文档将对软件的功能进行详细描述，定义软件运行的环境与条件，对软件的使用过程进行规范。同时，本用户手册也可以作为用户使用指引、软件分析参考以及软件测试依据，

本文档的预期用户为设计人员、开发人员、测试人员、用户。


#### 1.2 项目背景

Java 是由 Sun Microsystems 公司于 1995 年 5 月推出的高级程序设计语言，可运行于多个平台，如 Windows, Mac OS 及其他多种 UNIX 版本的系统。Java最初是一种纯粹的面向对象的语言，但现在已经发展成为一种多范例语言，可以高度适应任何情况，且拥有庞大的开发人员社区和支持库。

本次开发的工具为“面向Java的分析和理解工具”，用户可以通过该软件在网页端进行Java源代码的静态分析，包括构建代码抽象模型和程序切片等操作。

本项目为南京大学软件工程实验课程作业，小组成员需完成从项目后端到前端的完整团队开发，学习中小型软件项目的需求分析、设计、编码、测试、维护和管理，培养软件开发的工程化能力和项目的管理能力。


#### 1.3 定义

- **Java**：一种广泛使用的计算机编程语言，拥有跨平台、面向对象、泛型编程的特性，利用Java可以编写桌面应用程序、Web应用程序、分布式系统应用程序、嵌入式系统应用程序等。
- **AST** ：抽象语法树（abstract syntax tree，AST） 是源代码的抽象语法结构的树状表示，树上的每个节点都表示源代码中的一种结构。之所以说是抽象的，是因为抽象语法树并不会表示出真实语法出现的每一个细节，不依赖于源语言的语法。AST广泛应用于浏览器，智能编辑器，编译器等。
- **控制流图**：简称CFG，是Control Flow Graph的缩写，是计算机科学中的表示法，利用数学中图的表示方式，标示程序执行过程中所经过的所有路径。  
- **数据流图**：Data Flow Chart，简称DFG，是一种描述系统数据流程的主要工具，它用一组符号来描述整个系统中信息的全貌，综合地反映出信息在系统中的流动、处理和存储情况。
- **程序依赖图**：简称PDG，是程序的一种图形表示,它是带有标记的有向多重图，用于表示程序的控制依赖和数据依赖关系，是分析和理解程序的基础工具之一。
- **程序切片**：旨在从程序中提取满足一定约束条件的代码片段，是一种用于分解程序的程序分析技术。程序切片主要通过寻找程序内部的相关特性，从而分解程序，然后对分解所得的程序切片进行分析研究，以此达到对整个程序理解和认识的目的。

### 2.软件概述

#### 2.1 目标

本软件是一款面向所有注册用户的Java源程序的分析和理解工具，该项目旨在帮助用户对Java源代码进行静态分析，以获得代码中的控制与数据依赖关系，并且根据切片指令去除程序中的无关代码，更好的对用户感兴趣的变量进行代码定位。

#### 2.2 用户特点

本软件的用户是Java开发人员，有Java代码的分析需求，方便提取感兴趣的变量相关代码。

#### 2.3 假定和约束

- 开发截止时间：2023年7月16日
- 所采用的方法和技术有限：团队成员需在开发过程中学习多种Java代码分析技术
- 支持主流浏览器：Firefox/Chrome/Safari等
- 开发过程中，开发团队需要提交设计说明书，技术调研报告，用户手册，项目研发报告，接口文档等
- 开发环境：win10，IntelliJ IDEA，Visual Studio Code，MYSQL

### 3.运行环境

#### 3.1 服务器环境

测试服务器系统：Ubuntu桌面系统（20.04版本以上）

#### 3.2 后端运行环境

Java17及以上版本

MySQL 8.0及以上版本

Springboot 2.7

#### 3.3 前端运行环境

Nodejs 16.15.1

Vue.js 2

### 4.使用说明

#### 4.1 用户登录登出

下文所述界面以当前项目编译后部署的服务器(ip:172.27.138.195;port:8080)为例。在浏览器中连接到`http://172.24.127.73:8080//`后，即可进入用户登录界面。

##### 4.1.1 用户登录

在用户登录界面，输入正确的用户名和密码，然后点击“登录”按钮，即可登录。

登录成功后，浏览器会自动跳转至工具界面。

##### 4.1.2 用户登出

用户想要登出系统时，点击工具界面右上角的用户头像，选择“退出”，即可退出登录。

##### 4.1.3 用户权利

系统数据库会一直保存用户上传的文件，用户上传文件后，如果没有进行删除操作，在下次登录时，可以直接查看已上传的文件。

系统不会保存分析结果，所以在退出登录前，请及时下载结果文件。

#### 4.2 用户注册

如果没有注册过用户，可以进行注册。点击左下角的“还没有账号？立即注册”即可进入注册界面。

##### 4.2.1 用户注册

在用户注册界面，按序输入新建的用户名、密码，然后确认密码，最后输入邮箱和序号（非必须），最后单击注册即可完成注册。

注意：密码必须同时包含数字与字母，且长度未8-20位，若不满足条件，，密码输入栏下方会显示错误提示。

若“确认密码”内输入的内容与“密码”内输入的内容不同，也会显示错误提示。

##### 4.2.2 注册成功

注册成功后，浏览器会跳转至登录界面，此时输入用户名和密码即可登录。
----------------这一条，包括以下部分，错误操作我都没录制，错误报告的显示都没有写到------------------

##### 4.2.3 注册失败以及可能原因

有些情况下注册会失败：如用户名和密码不符合规则，或用户名已被注册，浏览器会给出相应的提示，请按照提示更改注册信息后再行注册。
-------------------是否实现错误提示----------------------

#### 4.3 主页

登录成功后，自动进入主页。

主页可以查看已经上传的所有文件，点击下方的三角形或在三角形左侧的选择栏选择页面，可以查看更多的文件。

##### 4.3.1 文件删除

点击文件右侧的“删除”按钮可以删除文件。

##### 4.3.2 查看已上传文件

主页可以查看已经上传的所有文件，点击下方的三角形或在三角形左侧的选择栏选择页面，可以查看更多的文件。

#### 4.4 源码上传

点击左侧“源码上传”选项，进入文件上传界面。从本地拖动文件到上传框，或者点击“点此上传”，选择本地文件，然后点击“提交”，均可进行文件上传操作。

点击“清空”可以清空上传框内的源码文件。


#### 4.5 查看代码分析结果

点击左侧的“代码分析”栏，会向下展开更多选项，点击可以查看对应的代码分析结果。

##### 4.5.1 AST

点击“AST”，进入AST生成界面。在上方的“选择文件”中选择想要查看的源文件名，然后点击“确定”，下方会显示该文件的AST树。

点击连线上的“+”或“-”图形可以展开或折叠AST树。

鼠标悬浮在节点上方会显示对应的节点信息。

若未选择文件就点击“确定”，浏览器会显示信息，提示错误。

##### 4.5.2 CFG

点击“CFG”，进入CFG生成界面。在上方先选择文件，再选择想要查看的函数，点击确定，下方会显示该函数的CFG图。

##### 4.5.3 CG

点击“CG”，进入CG生成界面。在上方选择文件，点击确定，下方会显示该函数的CG图。

##### 4.5.4 PDG

点击“PDG”，进入PDG生成界面。在上方先选择文件，再选择想要查看的函数，点击确定，下方会显示该函数的PDG图。

#### 4.6查看切片

点击左侧的“程序切片”栏，会向下展开更多选项，在此可以选择查看静态切片或是动态切片。

##### 4.6.1 静态切片

点击“静态切片”，在上方选择文件，再选择方法，最后在右侧输入想要查看切片结果的变量和其所在行数，下方左侧代码界面会显示源代码，右侧会显示静态切片结果。

##### 4.6.2 动态切片

点击“动态切片”，在上方选择文件，然后输入想要查看切片结果的语句的所在行数，下方左侧代码界面会显示源代码，右侧会显示切片结果。

#### 4.7 代码度量

点击左侧“代码度量”栏，会进入代码度量界面。

在左侧选择文件和想要查看的函数，然后点击“确定”，右侧显示框内会展示所有的代码度量结果，包括

- 针对函数：圈复杂度、代码深度、各类代码行信息、调用函数数量、被调用次数、其他诸如入参个数…
- 针对文件：代码行、注释行、代码注释率的信息

如果没有选择文件或是函数就点击“确定”，浏览器会弹出错误信息提示。

#### 4.8 报告生成

点击左侧“报告生成”栏，进入报告生成界面。

在上方选择想要获取分析报告的文件，点击“获取report”按钮，会开始进行分析结果文件的下载。

下方会显示下载进度。

### 5.功能说明

#### 5.1 工具支持的语言

本工具只支持.java文件，所有不是.java的文件均无法成功上传。

对于文件中的内容，需要符合java语言的语法，若不符合java语言的语法，则本文件会解析失败，在源文件解析失败的情况下不支持的功能中会收到错误反馈。

#### 5.2 工具支持的功能

##### 5.2.1 生成抽象语法树AST

- 支持所有Java文件，对于语法正确的文件正常产生AST，对于有语法错误的文件显示不可生成AST的错误讯息

##### 5.2.2 提取程序控制流结构CFG

- 支持所有java文件的控制流检查，打印时显示类名称和类下的函数名称
- 在控制流图中的节点代表了程序中的语句和判断语句，边代表了程序的控制流
- 覆盖顺序、分支（`switch case`、`if else`）、循环（`while`、`for`、`foreach`）结构
- 支持控制循环的辅助指令`break`、`return`、`continue`
- `else if`和`else`在`if`语句后检查，其中`else if`看做`else`下的statement含有新的`if`分支语句来处理
- 控制流结构的关键字：分支、循环语句用Begin和End标出，`switch`语句中，case用Switch_entry表示，辅助语句单独列出
- 只有能够通过编译的正确代码才有控制流图，每个类中的每个方法有一个控制流图
- 使用`graphviz-java`将得到的dot格式文件转为png格式

##### 5.2.3 方法间调用关系图CG

- 用户选择一个文件作为分析对象，生成文件中各类方法层层调用的关系图
- 所用节点集与CFG图相同
- 使用`graphviz-java`将得到的dot格式文件转为png格式

##### 5.2.4 源码间依赖关系图PDG

- 用户选中在源文件内的特定方法作为分析对象，生成该方法内的代码间程序依赖图
- 所用节点集与CFG图相同，除了exit节点
- 边根据控制流图中呈现的控制依赖关系和数据依赖关系来构建
- 控制依赖关系，根据两个节点的后支配关系构建
- 数据依赖关系定义为：一个节点w数据依赖于另一个节点v，当且仅当v节点对x变量进行了赋值，w节点使用了x变量，并且在CFG图中，有这样一条从v到w的路径，在这条路径上，没有任何语句对x有赋值。

##### 5.2.5 程序切片

- 用户首先选取想要切片的文件，选中后会展示源文件的代码内容
- 进行静态切片，需要先选取静态切片方法，通过输入行号选中需要切片的语句，再输入当前语句中存在的变量名，选取目标切片变量
- 切片结果同样以代码行形式展示
- 进行动态切片，需要选中输入的行号选中需要切片的语句，如果程序运行需要输入，则还需要一次性输入文件运行需要的的所有输入内容
- 动态切片仅支持包含main文件的可编译并运行的java文件，java文件的主类名需要与文件名一致。不可编译或不能正常运行的情况不生成切片，会显示错误讯息

##### 5.2.6 代码度量

- 针对于每个文件，如果有语法错误则提示解析失败的信息，如果解析成功，会根据用户选择输出该文件或函数的各类信息
- 针对函数：圈复杂度、代码深度、各类代码行信息、调用函数数量、被调用次数、其他诸如入参个数…
- 针对文件：代码行、注释行、代码注释率的信息
